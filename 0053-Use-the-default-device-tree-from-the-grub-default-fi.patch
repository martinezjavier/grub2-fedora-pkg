From 166c2c1cccae53d4a4357cffb17374e64883fc8f Mon Sep 17 00:00:00 2001
From: Fedora Ninjas <grub2-owner@fedoraproject.org>
Date: Wed, 12 Feb 2014 14:54:04 -0500
Subject: [PATCH 53/97] Use the default device tree from the grub default file

instead of hardcoding a value.

Signed-off-by: David A. Marlin <dmarlin@redhat.com>
---
 util/grub-mkconfig.in   | 3 ++-
 util/grub.d/10_linux.in | 4 ++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/util/grub-mkconfig.in b/util/grub-mkconfig.in
index c088b7054427..9d595ac058aa 100644
--- a/util/grub-mkconfig.in
+++ b/util/grub-mkconfig.in
@@ -235,7 +235,8 @@ export GRUB_DEFAULT \
   GRUB_ENABLE_CRYPTODISK \
   GRUB_BADRAM \
   GRUB_OS_PROBER_SKIP_LIST \
-  GRUB_DISABLE_SUBMENU
+  GRUB_DISABLE_SUBMENU \
+  GRUB_DEFAULT_DTB
 
 if test "x${grub_cfg}" != "x"; then
   rm -f "${grub_cfg}.new"
diff --git a/util/grub.d/10_linux.in b/util/grub.d/10_linux.in
index 462b461ff497..a9692a0c2a2a 100644
--- a/util/grub.d/10_linux.in
+++ b/util/grub.d/10_linux.in
@@ -232,8 +232,8 @@ while [ "x$list" != "x" ] ; do
 
   fdt=
   for i in "dtb-${version}" "dtb-${alt_version}"; do
-    if test -e "${dirname}/${i}/apm-mustang.dtb" ; then
-      fdt="${i}/apm-mustang.dtb"
+    if test -f "${dirname}/${i}/${GRUB_DEFAULT_DTB}" ; then
+      fdt="${i}/${GRUB_DEFAULT_DTB}"
       break
     fi
   done
-- 
2.13.0

